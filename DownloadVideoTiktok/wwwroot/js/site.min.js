var appVdl=appVdl||{},initCaptcha;appVdl.home=function(){var n=function(){$(".btn-share-fb").click(function(n){n.preventDefault();FB.ui({display:"popup",method:"share",href:document.location.href,redirect_uri:document.location.href},function(n){console.log(n)})});$(document).on("click",".btn-download-video",function(n){if(n.preventDefault(),!$(this).hasClass("isPosting")){var t=$(this);$(this).addClass("isPosting");$(this).addClass("d-none");$(this).parent().find("span").removeClass("d-none");$.post("/get-url-video",{id:$(this).attr("data-id")},function(n){fetch(n.data.url,{method:"GET",referrer:""}).then(function(n){var r=n.headers.get("Content-Length"),i=0,u=n.body.getReader(),f=new ReadableStream({start:function(n){function f(){u.read().then(function(u){if(u.done){n.close();return}i+=u.value.length;var e=Math.round(i/r*100);t.parent().addClass("p"+e);t.parent().find("span").html(e+"%");n.enqueue(u.value);f()})}f()}});return new Response(f)}).then(function(n){return n.blob()}).then(function(i){t.parent().find("span").addClass("d-none");t.parent().find(".btn-save-video").removeClass("d-none");var r=t.parent().find(".btn-save-video").get(0);r.href=window.URL.createObjectURL(i);r.download=n.data.fileName;r.click()}).catch(function(n){console.log(n);t.removeClass("isPosting");t.removeClass("d-none");t.parent().find("span").addClass("d-none");t.attr("data-trigger",parseInt(t.attr("data-trigger"))+1);parseInt(t.attr("data-trigger"))<=5&&setTimeout(function(){t.trigger("click")},1e3)})})}});$(document).on("click",".btn-download-all",function(){if($(".tbl-check:checked").length===0){swal("Please select video");return}$(".tbl-check:checked").each(function(){$(this).closest("tr").find(".btn-download-video").trigger("click")})});$(document).on("click",".btn-download-zip",function(){var t,n;if(!$(".btn-download-zip").hasClass("isPosting")){if(t=[],$(".tbl-check:checked").each(function(){t.push($(this).attr("data-item"))}),t.length===0){swal("Please select video");return}$(".btn-download-zip").addClass("isPosting");$(".btn-download-zip").html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>');n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var t=document.createElement("a");t.href=window.URL.createObjectURL(n.response);t.download=n.getResponseHeader("fileName");t.style.display="none";document.body.appendChild(t);t.click();$(".btn-download-zip").removeClass("isPosting");$(".btn-download-zip").html("Download ZIP")}};n.open("POST","/download-zip");n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val());n.responseType="blob";n.send($.param({ids:t}))}});$(document).on("click",".tbl-check-all",function(){var n=$(this).is(":checked");$(".tbl-check").each(function(){$(this).prop("checked",n)})});$(document).on("click",".tbl-check",function(){$(".tbl-check-all").prop("checked",$(".tbl-check:checked").length>0)});$("#form-video").validate({rules:{url:{required:!0}},messages:{url:"This field is required."},submitHandler:function(){return $("#form-video").hasClass("isPosting")||($("#form-video").addClass("isPosting"),$('#form-video button[type="submit"]').html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>'),$.ajax({type:"POST",url:"/get-video",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:$("#form-video").serialize(),success:function(n){$(".box-result").html(n)},complete:function(){$("#form-video").removeClass("isPosting");$('#form-video button[type="submit"]').html("Get link");appVdl.main.resetCaptcha()},failure:function(n){alert(n)}})),!1}});$("#txtUrl").val()!==""&&$("#form-video").submit()};return{init:n}}();appVdl.changepassword=function(){var n=function(){$("#form-change-password").validate({rules:{currentpassword:{required:!0},newpassword:{required:!0},renewpassword:{required:!0}},messages:{currentpassword:"Please enter information.",newpassword:"Please enter information.",renewpassword:"Please enter information."},submitHandler:function(){return $("#form-change-password").hasClass("isPosting")||($("#form-change-password").addClass("isPosting"),$('#form-change-password button[type="submit"]').html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>'),$(".alert-changepassword").removeClass("alert-success").addClass("alert-warning"),$(".alert-changepassword").removeClass("show").addClass("hide"),$.ajax({type:"POST",url:"/change-password",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:$("#form-change-password").serialize(),success:function(n){typeof n.error=="undefined"||n.error||($("#form-change-password").trigger("reset"),$(".alert-changepassword").removeClass("alert-warning").addClass("alert-success"));$(".alert-changepassword > span").html(n.message);$(".alert-changepassword").removeClass("hide").addClass("show")},complete:function(){$("#form-change-password").removeClass("isPosting");$('#form-change-password button[type="submit"]').html("Change")},failure:function(n){alert(n)}})),!1}})};return{init:n}}();appVdl.upgrade=function(){var n=function(n,t){paypal.Buttons({style:{shape:"pill",color:"blue",layout:"vertical",label:"paypal"},createOrder:function(){return $(n).addClass("d-none"),$(n).parent().append('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>'),$.post("/createPayment",{package:t}).done(function(n){return n}).then(function(n){return n.data})},onApprove:function(n){return fetch("/updatePayment",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:$.param({orderId:n.orderID})}).then(function(n){return n.json()}).then(function(n){swal(n.message).then(function(){document.location.reload()})})},onCancel:function(){$(n).removeClass("d-none");$(n).parent().find(".spinner-border").remove()}}).render(n)},t=function(){n("#btn-paypal-week","WEEK");n("#btn-paypal-month","MONTH");n("#btn-paypal-year","YEAR");$("#modal-notify").on("hidden.bs.modal",function(){$("#modal-notify").hasClass("isSuccess")&&document.location.reload()});$(".btn-upgrade").click(function(n){if(n.preventDefault(),!$(this).hasClass("isPosting")){var t=$(this);t.addClass("isPosting");t.html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>');$.ajax({type:"POST",url:"/upgrade",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:{package:t.attr("data-package")},success:function(n){typeof n.error=="undefined"||n.error||$("#modal-notify").addClass("isSuccess");$("#modal-notify .modal-body").html(n.message);$("#modal-notify").modal("show")},complete:function(){t.removeClass("isPosting");t.html("Upgrade")},failure:function(n){alert(n)}})}})};return{init:t}}();appVdl.getVideo=function(){var n=function(){$(".btn-getlink-download").click(function(n){if(n.preventDefault(),!$(this).hasClass("isPosting")){var t=$(this);$(this).addClass("isPosting");$(this).attr("disabled","disabled");$.post("/get-url-video",{id:$(this).attr("data-id")},function(n){fetch(n.data.url,{method:"GET",referrer:""}).then(function(n){var r=n.headers.get("Content-Length"),i=0,u=n.body.getReader(),f=new ReadableStream({start:function(n){function f(){u.read().then(function(u){if(u.done){n.close();return}i+=u.value.length;var e=Math.round(i/r*100);t.parent().find(".progress-bar").attr({style:"width: "+e+"%","aria-valuenow":e});n.enqueue(u.value);f()})}f()}});return new Response(f)}).then(function(n){return n.blob()}).then(function(t){var i=document.createElement("a");i.href=window.URL.createObjectURL(t);i.download=n.data.fileName;i.style.display="none";document.body.appendChild(i);i.click();i.remove()}).catch(function(n){console.log(n);t.removeClass("isPosting");t.removeAttr("disabled");t.attr("data-trigger",parseInt(t.attr("data-trigger"))+1);parseInt(t.attr("data-trigger"))<=5&&setTimeout(function(){t.trigger("click")},1e3)})})}})};return{init:n}}();initCaptcha=function(){$("#rcRegister").length>0&&grecaptcha.render("rcRegister",{sitekey:"6LcGQvkUAAAAAPFUw2yO9OBPlsRDg6VxAYVJWgsw"});$("#rcLogin").length>0&&grecaptcha.render("rcLogin",{sitekey:"6LcGQvkUAAAAAPFUw2yO9OBPlsRDg6VxAYVJWgsw"});$("#rcGetVideo").length>0&&grecaptcha.render("rcGetVideo",{sitekey:"6LcGQvkUAAAAAPFUw2yO9OBPlsRDg6VxAYVJWgsw"})};appVdl.main=function(){var n=function(){($("#rcRegister").length>0||$("#rcLogin").length>0||$("#rcGetVideo").length>0)&&grecaptcha.reset()},t=function(){$("#form-login").validate({rules:{username:{required:!0,email:!0},password:{required:!0,minlength:6,maxlength:32}},messages:{username:"This field is required.",password:"This field is required."},submitHandler:function(){return $("#form-login").hasClass("isPosting")||($("#form-login").addClass("isPosting"),$('#form-login button[type="submit"]').html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>'),$(".alert-login").addClass("d-none"),$.ajax({type:"POST",url:"/login",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:$("#form-login").serialize(),success:function(n){typeof n.error=="undefined"||n.error?($(".alert-login > span").html(n.message),$(".alert-login").removeClass("d-none")):document.location.reload()},complete:function(){$("#form-login").removeClass("isPosting");$('#form-login button[type="submit"]').html("Sign In");n()},failure:function(n){alert(n)}})),!1}});$("#form-register").validate({rules:{username:{required:!0,email:!0},password:{required:!0,minlength:6,maxlength:32},repassword:{required:!0,minlength:6,maxlength:32}},messages:{username:"This field is required.",password:"This field is required.",repassword:"This field is required."},submitHandler:function(){return $("#form-register").hasClass("isPosting")||($("#form-register").addClass("isPosting"),$('#form-register button[type="submit"]').html('<div class="spinner-border" role="status"><span class="sr-only">Loading...<\/span><\/div>'),$(".alert-register").addClass("d-none"),$.ajax({type:"POST",url:"/register",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:$("#form-register").serialize(),success:function(n){typeof n.error=="undefined"||n.error?($(".alert-register > span").html(n.message),$(".alert-register").removeClass("d-none")):document.location.reload()},complete:function(){$("#form-register").removeClass("isPosting");$('#form-register button[type="submit"]').html("Sign Up");n()},failure:function(n){alert(n)}})),!1}})};return{resetCaptcha:n,initAccount:t}}();$(document).ready(function(){appVdl.main.initAccount();(document.location.pathname==="/"||document.location.pathname==="/free-vip")&&appVdl.home.init();document.location.pathname==="/change-password"&&appVdl.changepassword.init();document.location.pathname==="/upgrade"&&appVdl.upgrade.init();document.location.pathname!=="/"&&document.location.search.indexOf("?url=")===0&&appVdl.getVideo.init()});